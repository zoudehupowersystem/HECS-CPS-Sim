# 主动配电网CPS统一行为建模与高效仿真平台

## 作者：邹德虎 

个人网页：https://zoudehupowersystem.github.io/zoudehu.github.io/

## 1. 项目概述

HECS-CPS-Sim 是一个基于C++20开发的高性能仿真平台，旨在为主动配电网 (Active Distribution Network, ADN) 中日益复杂和多样化的信息物理系统 (Cyber-Physical System, CPS) 应用提供统一的行为建模与高效的事件驱动仿真环境。**本项目当前主要作为学术研究的简化测试版本，用于验证所提出的建模与仿真方法的可行性与高效性。**

随着分布式能源、储能、电动汽车以及各类智能感知与控制装置在配电网中的广泛应用，传统的电力系统仿真工具在统一描述这些跨物理层与信息层、行为异构的业务，并高效处理其复杂的交互逻辑方面面临挑战。本项目提出的分层实体-组件-系统 (Hierarchical Entity-Component-System, HECS) 架构与基于C++20协程的事件驱动仿真引擎，致力于解决这些难题。

**目标用户：** 电力系统工程师、研究人员、从事主动配电网、微电网、虚拟电厂 (VPP)、CPS建模与仿真相关工作的开发者，**尤其适合对新型仿真技术进行学术探索与验证的场景。**

## 2. 项目特点与创新

* **统一的行为建模框架 (HECS)**：

  * **分层解耦**：通过实体（Entity）、组件（Component）和系统（System，由协程任务实现）三个层次，清晰地描述了物理设备（如IED、DTU、充电桩、储能单元）和信息系统应用（如VPP控制逻辑、馈线自动化主站）的行为。

  * **行为等效性**：组件模型遵循行为等效原则，关注设备或应用在特定业务场景下的外部行为特性和交互逻辑，而非精确复刻其内部复杂机理，显著降低了模型复杂度，提高了建模效率和通用性。

  * **模块化与可扩展性**：新的设备类型或CPS应用可以通过定义新的行为组件轻松集成到仿真平台中，具有良好的可扩展性。

* **基于C++20协程的高效事件驱动仿真引擎**：

  * **轻量级并发**：利用C++20协程实现用户态的轻量级并发，能够以极低的开销管理成千上万个并发执行的仿真对象（如每个充电桩的行为逻辑）。

  * **事件驱动核心**：仿真过程由离散事件驱动，仅当关键事件发生（如频率更新、故障注入）或特定条件满足（如VPP控制逻辑中的频率偏差阈值、时间阈值）时，才触发相关对象的行为计算与状态更新，大幅减少了不必要的计算，提高了仿真效率。

  * **异步逻辑的同步化表达**：通过 `co_await` 关键字，复杂的异步等待（如延时、等待外部事件）可以用同步的方式清晰表达，显著提升了代码的可读性和可维护性。

  * **多时间尺度支持**：能够自然地处理保护（毫秒级）、控制（秒/毫秒级）、调度（分钟/小时级）等不同时间尺度和响应频率的CPS应用。

* **高性能日志记录**：

  * 集成 `spdlog` 库，提供高性能、异步的日志记录功能，支持将详细的仿真数据在程序结束时统一写入文件，减少了仿真过程中的I/O瓶颈。

## 3. 关键技术栈

* **编程语言**: C++20 (充分利用其协程、模板、并发等新特性)

* **核心设计模式**:

  * 实体-组件-系统 (ECS) 架构 (本项目中体现为HECS)

  * 事件驱动架构 (Event-Driven Architecture, EDA)

* **并发模型**: C++20 Coroutines

* **日志库**: [spdlog](https://github.com/gabime/spdlog)

* **构建系统**: CMake

## 4. 已实现功能与示例应用

本项目当前已实现并演示了以下核心功能和应用场景（**作为简化测试版本，部分功能为原理性演示**）：

* **基础仿真引擎** (`cps_coro_lib.h`, `ecs_core.h`):

  * 基于协程的离散事件调度器。

  * 任务 (`Task`) 封装与管理。

  * 延时 (`Delay`) 和事件等待 (`EventAwaiter`) 机制。

  * 实体与组件的注册和管理 (`Registry`)。

* **虚拟电厂 (VPP) 频率响应仿真** (`frequency_system.*`):

  * 建模了大量电动汽车充电桩 (EVCS) 和分布式储能单元 (ESS) 作为VPP资源。

  * 每个资源单元具有独立的调频参数（死区、增益、功率上下限、SOC约束等）和动态SOC状态。

  * 模拟了电网频率扰动下，VPP根据聚合资源的可用容量和调频策略进行有功功率响应的过程。

  * 采用了**事件驱动的VPP控制逻辑**：仅在频率偏差变化显著或达到一定时间周期后，才对VPP内所有资源进行功率重计算和SOC更新，显著优化了计算效率。

* **简化保护逻辑仿真** (`protection_system.*`):

  * 演示了过流保护、距离保护等基本保护组件的建模。

  * 模拟了故障注入、保护元件启动、延时跳闸等基本保护信息物理交互过程。

  * （注：此部分在当前代码中作为演示，可进一步扩展以支持更复杂的馈线自动化等功能）。

* **仿真统计与结果输出**:

  * 记录仿真过程中的关键数据（如仿真时间、频率偏差、VPP总功率等）到CSV文件。

  * 统计并输出仿真的真实执行时间和峰值内存占用。

## 5. 如何构建与运行

### 依赖

* C++20 兼容的编译器 (推荐 GCC 10+ 或 Clang 12+)

* CMake (3.20 或更高版本)

* `spdlog` 库:

  * **Ubuntu/Debian**: `sudo apt install libspdlog-dev`

  * **其他系统或源码安装**: 请参考 `spdlog` 官方文档。

* `pthread` (通常在Linux系统中已具备)

### 构建步骤 (以Linux为例)


1. 克隆项目 (如果适用)
git clone
cd
2. 创建构建目录并进入
mkdir build
cd build

3. 运行 CMake (指定构建类型，如Release)
如果 spdlog 是通过 apt 安装的，CMake 通常能自动找到
cmake -DCMAKE_BUILD_TYPE=Release ..

如果 spdlog 头文件在项目本地的 include 目录 (如 MyProject/include/spdlog):
确保 CMakeLists.txt 中的 target_include_directories 指向正确位置
4. 编译
make -j$(nproc)

5. 运行
可执行文件通常在 build/bin/ 目录下
例如: ./bin/hecs_coro_simulation
以及对比版本: ./bin/traditional_threaded_simulation

请参考项目中的 `CMakeLists.txt` 文件获取详细的构建配置。

## 6. 预期应用与未来展望

* **主动配电网规划与运行分析**：评估不同控制策略、VPP配置、保护方案在复杂扰动下的性能。

* **CPS算法验证与优化**：为新的分布式控制、优化调度、故障诊断与自愈等算法提供高效的仿真验证平台。

* **教育与研究**：作为学习和研究电力系统CPS建模、事件驱动仿真、C++协程应用的实例。

未来工作可能包括：
* 扩展更丰富的电力设备和CPS应用模型库。

* 增强图形化界面和结果可视化功能。

* 支持与外部系统（如实时仿真器、SCADA）的交互。

* 进一步优化大规模系统仿真的性能。

## 7. 贡献与许可证

欢迎对本项目进行改进和贡献！

本项目旨在促进学术交流与技术验证，采用宽松的 **[MIT许可证](LICENSE.txt)**。这意味着您可以自由地使用、复制、修改、合并、出版发行、散布、再授权及贩售软件及软件的副本，惟须遵守下列条件：上述版权声明和本许可声明应包含在所有副本或实质部分的软件中。
